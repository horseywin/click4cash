<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Click4Cash - Space Edition</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        /* Basic reset and space theme */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            background: #000;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            gap: 30px;
            position: relative;
            overflow-y: scroll;
        }
        #top-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
        }
        button {
            background: #222;
            color: #fff;
            border: none;
            padding: 15px 25px;
            cursor: pointer;
            transition: 0.4s ease;
            font-size: 18px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        button:hover {
            background: #444;
            transform: translateY(-3px);
        }
        h1 {
            font-size: 48px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.7);
        }
        #click-btn {
            background: linear-gradient(45deg, #0084ff, #ff1a75);
            font-size: 30px;
            padding: 50px 100px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
            transform: scale(1);
            transition: transform 0.3s, background 0.4s ease;
            position: relative;
            z-index: 2;
        }
        #click-btn:hover {
            transform: scale(1.1);
            background: linear-gradient(45deg, #00d4ff, #ff69b3);
        }
        #click-btn:active {
            transform: scale(1);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.3);
        }
        .container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 60px;
        }
        .card {
            background: rgba(50, 50, 50, 0.8);
            padding: 20px;
            border-radius: 12px;
            width: 300px;
            text-align: center;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            transform: translateY(-30px);
            opacity: 0;
            animation: slideUp 0.5s ease-in-out forwards;
        }
        .card h3 {
            font-size: 22px;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        .card p {
            font-size: 16px;
            margin-bottom: 10px;
            color: #ccc;
        }
        .leaderboard-item {
            padding: 15px;
            border-radius: 8px;
            background: #444;
            margin-bottom: 15px;
            text-align: left;
            font-size: 16px;
            transition: background 0.3s;
        }
        .leaderboard-item:hover {
            background: #666;
        }
        /* Animations */
        @keyframes slideUp {
            0% { transform: translateY(30px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        /* Space background and stars */
        .space-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0.6;
            animation: moveStars 20s linear infinite;
        }
        @keyframes moveStars {
            0% { transform: translateY(-100vh); }
            100% { transform: translateY(100vh); }
        }
        /* Particle effects */
        .particle {
            position: absolute;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0));
            border-radius: 50%;
            pointer-events: none;
            animation: particleFade 1s ease-out forwards;
            z-index: 1;
        }
        @keyframes particleFade {
            0% { opacity: 1; transform: scale(0.1); }
            100% { opacity: 0; transform: scale(1.5); }
        }
        /* Popup styles */
        #login-popup, #signup-popup, #welcome-popup, #leaderboard-popup, #rules-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #333;
            padding: 30px;
            border-radius: 15px;
            z-index: 10;
            color: #fff;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 400px;
        }
        #login-popup h2, #signup-popup h2, #welcome-popup h2, #leaderboard-popup h2, #rules-popup h2 {
            margin-bottom: 20px;
            font-size: 24px;
        }
        #login-popup input, #signup-popup input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #555;
            border-radius: 8px;
            background: #444;
            color: #fff;
            font-size: 16px;
        }
        #login-popup button, #signup-popup button, #welcome-popup button, #leaderboard-popup button, #rules-popup button {
            background: #0084ff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background 0.3s ease;
        }
        #login-popup button:hover, #signup-popup button:hover, #welcome-popup button:hover, #leaderboard-popup button:hover, #rules-popup button:hover {
            background: #00d4ff;
        }
        #login-popup button[type="submit"], #signup-popup button[type="submit"] {
            background: #ff1a75;
        }
        #login-popup button[type="submit"]:hover, #signup-popup button[type="submit"]:hover {
            background: #ff69b3;
        }
        #welcome-popup p, #rules-popup p {
            margin-bottom: 20px;
            font-size: 18px;
            color: #ccc;
        }
        /* Overlay style */
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 5;
            display: none;
        }
    </style>
</head>
<body>
    <div id="top-bar">
        <button id="login-btn" onclick="showLogin()">Login</button>
        <button id="signup-btn" onclick="showSignUp()">Sign Up</button>
        <button onclick="logout()" id="logout-btn" style="display: none;">Logout</button>
    </div>

    <h1>Click4Cash - Space Edition</h1>
    <button id="click-btn" onclick="incrementClicks()">Click Me!</button>
    <p id="click-message" style="color: red; display: none;">Please sign in to start clicking!</p>

    <div class="container">
        <div class="card">
            <h3>Your Clicks</h3>
            <p id="click-count">0</p>
        </div>
        <div class="card">
            <h3>Leaderboard</h3>
            <div id="leaderboard"></div>
            <button onclick="showLeaderboardPopup()">See All</button>
        </div>
        <div class="card">
            <h3>Your Profile</h3>
            <p id="user-email">Not Logged In</p>
            <p id="join-date"></p>
            <p id="playtime"></p>
            <p id="chance-of-winning">Chance of Winning: 0%</p>
        </div>
    </div>

    <!-- Welcome Popup -->
    <div id="welcome-popup">
        <h2>Welcome to Click4Cash!</h2>
        <p>Thank you for signing up. You will earn 50% of the daily ad revenue if you win!</p>
        <button onclick="closeWelcomePopup()">Got It!</button>
    </div>

    <!-- Rules Popup -->
    <div id="rules-popup">
        <h2>How Click4Cash Works</h2>
        <p>Click the button as many times as you can to increase your chances of winning. Each click is an entry into the daily lucky draw. The more you click, the higher your chance of winning! The winner receives 50% of the daily ad revenue.</p>
        <button onclick="closeRulesPopup()">Got It!</button>
    </div>

    <!-- Leaderboard Popup -->
    <div id="leaderboard-popup">
        <h2>Full Leaderboard</h2>
        <div id="full-leaderboard"></div>
        <button onclick="hideLeaderboardPopup()">Close</button>
    </div>

    <!-- Login Popup -->
    <div id="overlay"></div>
    <div id="login-popup">
        <h2>Sign In</h2>
        <form onsubmit="login(event)">
            <input type="email" id="email" placeholder="Email" required><br>
            <input type="password" id="password" placeholder="Password" required><br>
            <button type="submit">Login</button>
        </form>
        <button onclick="hideLogin()">Cancel</button>
    </div>

    <!-- Sign Up Popup -->
    <div id="signup-popup">
        <h2>Sign Up</h2>
        <form onsubmit="signUp(event)">
            <input type="email" id="signup-email" placeholder="Email" required><br>
            <input type="password" id="signup-password" placeholder="Password" required><br>
            <p><small>By signing up, you agree to receive an email confirmation if you win!</small></p>
            <button type="submit">Sign Up</button>
        </form>
        <button onclick="hideSignUp()">Cancel</button>
    </div>

    <div class="space-background" id="space-background"></div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCQeZ1EOPbHOy8_wOBBvlchZwj8tTCZM2w",
            authDomain: "click4cash-7e106.firebaseapp.com",
            projectId: "click4cash-7e106",
            storageBucket: "click4cash-7e106.appspot.com",
            messagingSenderId: "689145020485",
            appId: "1:689145020485:web:458d083ec5bca7d8b3e32c"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let totalClicks = 0;
        let localClicks = 0;
        let clickBuffer = 0;
        let syncTimeout = null;
        let baseStarSpeed = 20; // Base speed in seconds for star animation
        let clickSpeedBoost = false;

        // Show rules popup on first visit
        if (!localStorage.getItem('visited')) {
            showRulesPopup();
            localStorage.setItem('visited', 'true');
        }

        // Initialize space background with stars
        function initSpaceBackground() {
            const spaceBackground = document.getElementById('space-background');
            const starCount = 100; // Number of stars
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.width = `${Math.random() * 3 + 1}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * -100}vh`; // Start above the screen
                star.style.animationDuration = `${baseStarSpeed + Math.random() * 10}s`; // Randomize speed slightly
                spaceBackground.appendChild(star);
            }
        }

        // Update star speed dynamically
        function updateStarSpeed(faster = false) {
            const stars = document.querySelectorAll('.star');
            const newSpeed = faster ? baseStarSpeed / 2 : baseStarSpeed; // Halve duration when clicking
            stars.forEach(star => {
                star.style.animationDuration = `${newSpeed + Math.random() * 5}s`;
            });
        }

        // Create click particles
        function createParticles(x, y) {
            const clickBtn = document.getElementById('click-btn');
            for (let i = 0; i < 10; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                const size = Math.random() * 20 + 10;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${x - size / 2}px`;
                particle.style.top = `${y - size / 2}px`;
                const angle = Math.random() * 2 * Math.PI;
                const velocity = Math.random() * 100 + 50;
                particle.style.transform = `translate(${Math.cos(angle) * velocity}px, ${Math.sin(angle) * velocity}px)`;
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1000); // Remove after animation
            }
        }

        // Fetch leaderboard data and update
        function updateLeaderboard() {
            db.collection("users").orderBy("clicks", "desc").get()
                .then((snapshot) => {
                    let leaderboardHTML = '';
                    totalClicks = 0;
                    snapshot.forEach(doc => {
                        const userData = doc.data();
                        if (userData.clicks !== undefined) {
                            leaderboardHTML += `<div class="leaderboard-item">${userData.email} - ${userData.clicks} clicks</div>`;
                            totalClicks += userData.clicks;
                        }
                    });
                    document.getElementById('leaderboard').innerHTML = leaderboardHTML;
                    updateChanceOfWinning();
                })
                .catch(err => {
                    console.error("Error fetching leaderboard: ", err);
                });
        }

        // Update chance of winning
        function updateChanceOfWinning() {
            if (currentUser) {
                const userRef = db.collection("users").doc(currentUser.uid);
                userRef.get().then((doc) => {
                    if (doc.exists) {
                        const userClicks = doc.data().clicks || 0;
                        const chance = totalClicks > 0 ? ((userClicks / totalClicks) * 100).toFixed(2) : 0;
                        document.getElementById('chance-of-winning').innerText = `Chance of Winning: ${chance}%`;
                    }
                });
            }
        }

        // Show full leaderboard popup
        function showLeaderboardPopup() {
            db.collection("users").orderBy("clicks", "desc").get()
                .then((snapshot) => {
                    let leaderboardHTML = '';
                    snapshot.forEach(doc => {
                        const userData = doc.data();
                        if (userData.clicks !== undefined) {
                            leaderboardHTML += `<div class="leaderboard-item">${userData.email} - ${userData.clicks} clicks</div>`;
                        }
                    });
                    document.getElementById('full-leaderboard').innerHTML = leaderboardHTML;
                    document.getElementById('leaderboard-popup').style.display = 'block';
                    document.getElementById('overlay').style.display = 'block';
                })
                .catch(err => {
                    console.error("Error fetching leaderboard: ", err);
                });
        }

        // Hide leaderboard popup
        function hideLeaderboardPopup() {
            document.getElementById('leaderboard-popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // Show rules popup
        function showRulesPopup() {
            document.getElementById('rules-popup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        // Hide rules popup
        function closeRulesPopup() {
            document.getElementById('rules-popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // Show login popup
        function showLogin() {
            document.getElementById('login-popup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        // Hide login popup
        function hideLogin() {
            document.getElementById('login-popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // Show signup popup
        function showSignUp() {
            document.getElementById('signup-popup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        // Hide signup popup
        function hideSignUp() {
            document.getElementById('signup-popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // Show welcome popup
        function showWelcomePopup() {
            document.getElementById('welcome-popup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        // Hide welcome popup
        function closeWelcomePopup() {
            document.getElementById('welcome-popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // Login function
        function login(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    loadUserData();
                    updateLeaderboard();
                    document.getElementById('click-message').style.display = 'none';
                    document.getElementById('login-btn').style.display = 'none';
                    document.getElementById('signup-btn').style.display = 'none';
                    document.getElementById('logout-btn').style.display = 'inline-block';
                    document.getElementById('click-btn').disabled = false;
                    hideLogin();
                    document.getElementById('user-email').innerText = currentUser.email;
                })
                .catch((error) => {
                    alert("Login failed: " + error.message);
                });
        }

        // Signup function
        function signUp(event) {
            event.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;

                    const userRef = db.collection("users").doc(currentUser.uid);
                    userRef.set({
                        email: currentUser.email,
                        clicks: 0,
                        joinDate: new Date().toISOString(),
                        playtime: 0
                    }).then(() => {
                        updateLeaderboard();
                        hideSignUp();
                        showWelcomePopup();
                        document.getElementById('login-btn').style.display = 'none';
                        document.getElementById('signup-btn').style.display = 'none';
                        document.getElementById('logout-btn').style.display = 'inline-block';
                        document.getElementById('user-email').innerText = currentUser.email;
                    }).catch((error) => {
                        console.error("Error creating user document: ", error);
                    });
                })
                .catch((error) => {
                    alert("Sign Up failed: " + error.message);
                });
        }

        // Logout function
        function logout() {
            auth.signOut().then(() => {
                currentUser = null;
                localClicks = 0;
                clickBuffer = 0;
                document.getElementById('click-count').innerText = '0';
                document.getElementById('user-email').innerText = 'Not Logged In';
                document.getElementById('chance-of-winning').innerText = 'Chance of Winning: 0%';
                document.getElementById('login-btn').style.display = 'inline-block';
                document.getElementById('signup-btn').style.display = 'inline-block';
                document.getElementById('logout-btn').style.display = 'none';
                document.getElementById('click-message').style.display = 'block';
                document.getElementById('click-btn').disabled = true;
            }).catch((error) => {
                console.error("Logout failed: ", error);
            });
        }

        // Load user data on login
        function loadUserData() {
            if (currentUser) {
                const userRef = db.collection("users").doc(currentUser.uid);
                userRef.get().then((doc) => {
                    if (doc.exists) {
                        localClicks = doc.data().clicks || 0;
                        document.getElementById('click-count').innerText = localClicks;
                        document.getElementById('join-date').innerText = `Joined: ${new Date(doc.data().joinDate).toLocaleDateString()}`;
                    }
                }).catch((error) => {
                    console.error("Error loading user data: ", error);
                });
            }
        }

        // Sync clicks with Firebase
        function syncClicks() {
            if (clickBuffer > 0 && currentUser) {
                const userRef = db.collection("users").doc(currentUser.uid);
                userRef.update({
                    clicks: firebase.firestore.FieldValue.increment(clickBuffer)
                }).then(() => {
                    clickBuffer = 0;
                    updateLeaderboard();
                }).catch(err => {
                    console.error("Error syncing clicks: ", err);
                });
            }
        }

        // Increment clicks with effects
        function incrementClicks(event) {
            if (!currentUser) {
                document.getElementById('click-message').style.display = 'block';
                return;
            }

            document.getElementById('click-message').style.display = 'none';
            localClicks += 1;
            clickBuffer += 1;
            document.getElementById('click-count').innerText = localClicks;

            // Trigger particle effect
            const rect = document.getElementById('click-btn').getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top + rect.height / 2;
            createParticles(x, y);

            // Speed up stars temporarily
            if (!clickSpeedBoost) {
                clickSpeedBoost = true;
                updateStarSpeed(true);
                setTimeout(() => {
                    clickSpeedBoost = false;
                    updateStarSpeed(false);
                }, 2000); // Slow down after 2 seconds
            }

            // Debounce sync to Firebase
            if (syncTimeout) clearTimeout(syncTimeout);
            syncTimeout = setTimeout(syncClicks, 500);
        }

        // Initialize game
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                loadUserData();
                updateLeaderboard();
                document.getElementById('login-btn').style.display = 'none';
                document.getElementById('signup-btn').style.display = 'none';
                document.getElementById('logout-btn').style.display = 'inline-block';
                document.getElementById('click-btn').disabled = false;
                document.getElementById('user-email').innerText = currentUser.email;
            } else {
                currentUser = null;
                localClicks = 0;
                clickBuffer = 0;
                document.getElementById('click-count').innerText = '0';
                document.getElementById('user-email').innerText = 'Not Logged In';
                document.getElementById('login-btn').style.display = 'inline-block';
                document.getElementById('signup-btn').style.display = 'inline-block';
                document.getElementById('logout-btn').style.display = 'none';
                document.getElementById('click-btn').disabled = true;
            }
        });

        // Start the game
        initSpaceBackground();
        updateLeaderboard();
    </script>
</body>
</html>